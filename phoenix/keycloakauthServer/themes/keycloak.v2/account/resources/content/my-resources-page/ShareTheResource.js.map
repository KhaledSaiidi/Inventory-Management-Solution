{"version":3,"file":"ShareTheResource.js","names":["React","Button","Chip","ChipGroup","Form","FormGroup","Gallery","GalleryItem","Modal","Stack","StackItem","TextInput","ModalVariant","AccountServiceContext","Msg","ContentAlert","PermissionSelect","ShareTheResource","Component","constructor","props","context","rscId","resource","_id","newPermissions","permission","state","permissionsSelected","push","name","permissions","username","usernames","scopes","handleToggleDialog","doPut","encodeURIComponent","then","success","onClose","isOpen","setState","clearState","usernameInput","includes","response","doGet","params","value","data","info","event","key","preventDefault","handleAddUsername","newUsernames","filter","user","permissionsUnSelected","isAddDisabled","isAlreadyShared","isFormInvalid","length","render","children","large","handleAddPermission","localize","handleUsernameChange","handleEnterKeyInAddField","map","currentChip","handleDeleteUsername","selection","sharedWithUsersMsg"],"sources":["../../../src/app/content/my-resources-page/ShareTheResource.tsx"],"sourcesContent":["/*\n * Copyright 2019 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as React from 'react';\n\nimport {\n    Button,\n    Chip,\n    ChipGroup,\n    Form,\n    FormGroup,\n    Gallery,\n    GalleryItem,\n    Modal,\n    Stack,\n    StackItem,\n    TextInput,\n    ModalVariant\n} from '@patternfly/react-core';\n\nimport { AccountServiceContext } from '../../account-service/AccountServiceContext';\nimport { Resource, Permission, Scope } from './resource-model';\nimport { Msg } from '../../widgets/Msg';\nimport {ContentAlert} from '../ContentAlert';\nimport { PermissionSelect } from './PermissionSelect';\n\ninterface ShareTheResourceProps {\n    resource: Resource;\n    permissions: Permission[];\n    sharedWithUsersMsg: React.ReactNode;\n    onClose: () => void;\n    children: (toggle: () => void) => void;\n}\n\ninterface ShareTheResourceState {\n    isOpen: boolean;\n    permissionsSelected: Scope[];\n    permissionsUnSelected: Scope[];\n    usernames: string[];\n    usernameInput: string;\n}\n\n/**\n * @author Stan Silvert ssilvert@redhat.com (C) 2019 Red Hat Inc.\n */\nexport class ShareTheResource extends React.Component<ShareTheResourceProps, ShareTheResourceState> {\n    protected static defaultProps:any = {permissions: []};\n    static contextType = AccountServiceContext;\n    context: React.ContextType<typeof AccountServiceContext>;\n\n    public constructor(props: ShareTheResourceProps, context: React.ContextType<typeof AccountServiceContext>) {\n        super(props);\n        this.context = context;\n    \n        this.state = {\n            isOpen: false,\n            permissionsSelected: [],\n            permissionsUnSelected: this.props.resource.scopes,\n            usernames: [],\n            usernameInput: ''\n        };\n    }\n\n    private clearState(): void {\n        this.setState({\n            permissionsSelected: [],\n            permissionsUnSelected: this.props.resource.scopes,\n            usernames: [],\n            usernameInput: ''\n        });\n    }\n\n    private handleAddPermission = () => {\n        const rscId: string = this.props.resource._id;\n        const newPermissions: string[] = [];\n\n        for (const permission of this.state.permissionsSelected) {\n            newPermissions.push(permission.name);\n        }\n\n        const permissions = [];\n\n        for (const username of this.state.usernames) {\n            permissions.push({username: username, scopes: newPermissions});\n        }\n\n        this.handleToggleDialog();\n\n        this.context!.doPut(`/resources/${encodeURIComponent(rscId)}/permissions`, permissions)\n            .then(() => {\n                ContentAlert.success('shareSuccess');\n                this.props.onClose();\n            })\n    };\n\n    private handleToggleDialog = () => {\n       if (this.state.isOpen) {\n           this.setState({isOpen: false});\n           this.props.onClose();\n       } else {\n           this.clearState();\n           this.setState({isOpen: true});\n       }\n    };\n\n    private handleUsernameChange = (username: string) => {\n        this.setState({usernameInput: username});\n    }\n\n    private handleAddUsername = async () => {\n        if ((this.state.usernameInput !== '') && (!this.state.usernames.includes(this.state.usernameInput))) {\n            const response = await this.context!.doGet<{username: string}>(`/resources/${encodeURIComponent(this.props.resource._id)}/user`, { params: { value: this.state.usernameInput } });\n            if (response.data && response.data.username) {\n                this.setState({ usernameInput: '', usernames: [...this.state.usernames, this.state.usernameInput] });\n            } else {\n                ContentAlert.info('userNotFound', [this.state.usernameInput]);\n            }\n        }\n    }\n\n    private handleEnterKeyInAddField = (event: React.KeyboardEvent) => {\n        if (event.key === \"Enter\") {\n            event.preventDefault();\n            this.handleAddUsername();\n        }\n    }\n\n    private handleDeleteUsername = (username: string) => {\n        const newUsernames: string[] = this.state.usernames.filter(user => user !== username);\n        this.setState({usernames: newUsernames});\n    }\n\n    private isAddDisabled(): boolean {\n        return this.state.usernameInput === '' || this.isAlreadyShared();\n    }\n\n    private isAlreadyShared(): boolean {\n        for (let permission of this.props.permissions) {\n            if (permission.username === this.state.usernameInput) return true;\n        }\n\n        return false;\n    }\n\n    private isFormInvalid(): boolean {\n        return (this.state.usernames.length === 0) || (this.state.permissionsSelected.length === 0);\n    }\n\n    public render(): React.ReactNode {\n        return (\n            <React.Fragment>\n                {this.props.children(this.handleToggleDialog)}\n\n                <Modal\n                title={'Share the resource - ' + this.props.resource.name}\n                variant={ModalVariant.large}\n                isOpen={this.state.isOpen}\n                onClose={this.handleToggleDialog}\n                actions={[\n                    <Button key=\"cancel\" variant=\"link\" onClick={this.handleToggleDialog}>\n                        <Msg msgKey='cancel'/>\n                    </Button>,\n                    <Button key=\"confirm\" variant=\"primary\" id=\"done\" onClick={this.handleAddPermission} isDisabled={this.isFormInvalid()}>\n                        <Msg msgKey='done'/>\n                    </Button>\n                ]}\n                >\n                    <Stack hasGutter>\n                        <StackItem isFilled>\n                        <Form>\n                            <FormGroup\n                                label=\"Add users to share your resource with\"\n                                type=\"string\"\n                                helperTextInvalid={Msg.localize('resourceAlreadyShared')}\n                                fieldId=\"username\"\n                                isRequired\n                                >\n                                    <Gallery hasGutter>\n                                        <GalleryItem>\n                                            <TextInput\n                                                value={this.state.usernameInput}\n                                                id=\"username\"\n                                                aria-describedby=\"username-helper\"\n                                                placeholder=\"Username or email\"\n                                                onChange={this.handleUsernameChange}\n                                                onKeyPress={this.handleEnterKeyInAddField}\n                                            />\n                                        </GalleryItem>\n                                        <GalleryItem>\n                                            <Button key=\"add-user\" variant=\"primary\" id=\"add\" onClick={this.handleAddUsername} isDisabled={this.isAddDisabled()}>\n                                                <Msg msgKey=\"add\"/>\n                                            </Button>\n                                        </GalleryItem>\n\n                                </Gallery>\n                                <ChipGroup categoryName={Msg.localize('shareWith')}>\n                                    {this.state.usernames.map((currentChip: string) => (\n                                        <Chip key={currentChip} onClick={() => this.handleDeleteUsername(currentChip)}>\n                                            {currentChip}\n                                        </Chip>\n                                    ))}\n                                </ChipGroup>\n                            </FormGroup>\n                            <FormGroup\n                                label=\"\"\n                                fieldId=\"permissions-selected\"\n                            >\n                                <PermissionSelect\n                                    scopes={this.state.permissionsUnSelected}\n                                    onSelect={selection => this.setState({ permissionsSelected: selection })}\n                                    direction=\"up\"\n                                />\n                            </FormGroup>\n                        </Form>\n                    </StackItem>\n                    <StackItem isFilled><br/></StackItem>\n                    <StackItem isFilled>\n                        {this.props.sharedWithUsersMsg}\n                    </StackItem>\n\n                    </Stack>\n                </Modal>\n            </React.Fragment>\n        );\n    }\n}\n"],"mappings":"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"}