{"version":3,"file":"keycloak.service.js","names":["KeycloakService","constructor","keycloak","keycloakAuth","authenticated","audiencePresent","tokenParsed","audience","Array","isArray","indexOf","login","options","logout","redirectUri","baseUrl","account","accountManagement","authServerUrl","charAt","length","realm","getToken","Promise","resolve","reject","token","updateToken","then","catch"],"sources":["../../src/app/keycloak-service/keycloak.service.ts"],"sourcesContent":["/*\n * Copyright 2017 Red Hat, Inc. and/or its affiliates\n * and other contributors as indicated by the @author tags.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport Keycloak, { KeycloakLoginOptions } from \"../../../../../../../../../../js/libs/keycloak-js\";\n\ndeclare const baseUrl: string;\nexport type KeycloakClient = Keycloak;\n\nexport class KeycloakService {\n    private keycloakAuth: KeycloakClient;\n\n    public constructor(keycloak: KeycloakClient) {\n        this.keycloakAuth = keycloak;\n    }\n\n    public authenticated(): boolean {\n        return this.keycloakAuth.authenticated ? this.keycloakAuth.authenticated : false;\n    }\n\n    public audiencePresent(): boolean {\n        if (this.keycloakAuth.tokenParsed) {\n            const audience = this.keycloakAuth.tokenParsed['aud'];\n            return audience === 'account' || (Array.isArray(audience) && audience.indexOf('account') >= 0);\n        }\n        return false;\n    }\n\n    public login(options?: KeycloakLoginOptions): void {\n        this.keycloakAuth.login(options);\n    }\n\n    public logout(redirectUri: string = baseUrl): void {\n        this.keycloakAuth.logout({redirectUri: redirectUri});\n    }\n\n    public account(): void {\n        this.keycloakAuth.accountManagement();\n    }\n\n    public authServerUrl(): string | undefined {\n        const authServerUrl = this.keycloakAuth.authServerUrl;\n        return authServerUrl!.charAt(authServerUrl!.length - 1) === '/' ? authServerUrl : authServerUrl + '/';\n    }\n\n    public realm(): string | undefined {\n        return this.keycloakAuth.realm;\n    }\n\n    public getToken(): Promise<string> {\n        return new Promise<string>((resolve, reject) => {\n            if (this.keycloakAuth.token) {\n                this.keycloakAuth\n                    .updateToken(5)\n                    .then(() => {\n                        resolve(this.keycloakAuth.token as string);\n                    })\n                    .catch(() => {\n                        reject('Failed to refresh token');\n                    });\n            } else {\n                reject('Not logged in');\n            }\n        });\n    }\n}\n"],"mappings":";;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAMA,OAAO,MAAMA,eAAN,CAAsB;EAGlBC,WAAW,CAACC,QAAD,EAA2B;IAAA;;IACzC,KAAKC,YAAL,GAAoBD,QAApB;EACH;;EAEME,aAAa,GAAY;IAC5B,OAAO,KAAKD,YAAL,CAAkBC,aAAlB,GAAkC,KAAKD,YAAL,CAAkBC,aAApD,GAAoE,KAA3E;EACH;;EAEMC,eAAe,GAAY;IAC9B,IAAI,KAAKF,YAAL,CAAkBG,WAAtB,EAAmC;MAC/B,MAAMC,QAAQ,GAAG,KAAKJ,YAAL,CAAkBG,WAAlB,CAA8B,KAA9B,CAAjB;MACA,OAAOC,QAAQ,KAAK,SAAb,IAA2BC,KAAK,CAACC,OAAN,CAAcF,QAAd,KAA2BA,QAAQ,CAACG,OAAT,CAAiB,SAAjB,KAA+B,CAA5F;IACH;;IACD,OAAO,KAAP;EACH;;EAEMC,KAAK,CAACC,OAAD,EAAuC;IAC/C,KAAKT,YAAL,CAAkBQ,KAAlB,CAAwBC,OAAxB;EACH;;EAEMC,MAAM,CAACC,WAAmB,GAAGC,OAAvB,EAAsC;IAC/C,KAAKZ,YAAL,CAAkBU,MAAlB,CAAyB;MAACC,WAAW,EAAEA;IAAd,CAAzB;EACH;;EAEME,OAAO,GAAS;IACnB,KAAKb,YAAL,CAAkBc,iBAAlB;EACH;;EAEMC,aAAa,GAAuB;IACvC,MAAMA,aAAa,GAAG,KAAKf,YAAL,CAAkBe,aAAxC;IACA,OAAOA,aAAa,CAAEC,MAAf,CAAsBD,aAAa,CAAEE,MAAf,GAAwB,CAA9C,MAAqD,GAArD,GAA2DF,aAA3D,GAA2EA,aAAa,GAAG,GAAlG;EACH;;EAEMG,KAAK,GAAuB;IAC/B,OAAO,KAAKlB,YAAL,CAAkBkB,KAAzB;EACH;;EAEMC,QAAQ,GAAoB;IAC/B,OAAO,IAAIC,OAAJ,CAAoB,CAACC,OAAD,EAAUC,MAAV,KAAqB;MAC5C,IAAI,KAAKtB,YAAL,CAAkBuB,KAAtB,EAA6B;QACzB,KAAKvB,YAAL,CACKwB,WADL,CACiB,CADjB,EAEKC,IAFL,CAEU,MAAM;UACRJ,OAAO,CAAC,KAAKrB,YAAL,CAAkBuB,KAAnB,CAAP;QACH,CAJL,EAKKG,KALL,CAKW,MAAM;UACTJ,MAAM,CAAC,yBAAD,CAAN;QACH,CAPL;MAQH,CATD,MASO;QACHA,MAAM,CAAC,eAAD,CAAN;MACH;IACJ,CAbM,CAAP;EAcH;;AAvDwB"}