{"version":3,"file":"EditTheResource.js","names":["React","Button","Modal","Form","FormGroup","TextInput","InputGroup","ModalVariant","OkIcon","Scope","Msg","AccountServiceContext","ContentAlert","PermissionSelect","EditTheResource","Component","constructor","props","context","state","isOpen","setState","onClose","clearState","row","changed","savePermission","permission","doPut","encodeURIComponent","resource","_id","success","localize","render","children","handleToggleDialog","name","large","permissions","map","p","username","scopes","s","length","selection","updateChanged"],"sources":["../../../src/app/content/my-resources-page/EditTheResource.tsx"],"sourcesContent":["/*\n * Copyright 2019 Red Hat, Inc. and/or its affiliates.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport * as React from 'react';\n\nimport {\n    Button,\n    Modal,\n    Form,\n    FormGroup,\n    TextInput,\n    InputGroup,\n    ModalVariant\n} from '@patternfly/react-core';\nimport { OkIcon } from '@patternfly/react-icons';\n\nimport { Resource, Permission, Permissions, Scope } from './resource-model';\nimport { Msg } from '../../widgets/Msg';\nimport { AccountServiceContext } from '../../account-service/AccountServiceContext';\nimport { ContentAlert } from '../ContentAlert';\nimport { PermissionSelect } from './PermissionSelect';\n\ninterface EditTheResourceProps {\n    resource: Resource;\n    permissions: Permission[];\n    onClose: () => void;\n    children: (toggle: () => void) => void;\n}\n\ninterface EditTheResourceState {\n    changed: boolean[];\n    isOpen: boolean;\n}\n\nexport class EditTheResource extends React.Component<EditTheResourceProps, EditTheResourceState> {\n    protected static defaultProps:Permissions = { permissions: [] };\n    static contextType = AccountServiceContext;\n    context: React.ContextType<typeof AccountServiceContext>;\n\n    public constructor(props: EditTheResourceProps, context: React.ContextType<typeof AccountServiceContext>) {\n        super(props);\n        this.context = context;\n\n        this.state = {\n            changed: [],\n            isOpen: false,\n        };\n    }\n\n    private clearState(): void {\n        this.setState({});\n    }\n\n    private handleToggleDialog = () => {\n        if (this.state.isOpen) {\n            this.setState({ isOpen: false });\n            this.props.onClose();\n        } else {\n            this.clearState();\n            this.setState({ isOpen: true });\n        }\n    };\n\n    private updateChanged = (row: number) => {\n        const changed = this.state.changed;\n        changed[row] = !changed[row];\n        this.setState({ changed });\n    }\n\n    async savePermission(permission: Permission): Promise<void> {\n        await this.context!.doPut(`/resources/${encodeURIComponent(this.props.resource._id)}/permissions`, [permission]);\n        ContentAlert.success(Msg.localize('updateSuccess'));\n    }\n\n    public render(): React.ReactNode {\n        return (\n            <React.Fragment>\n                {this.props.children(this.handleToggleDialog)}\n\n                <Modal\n                    title={'Edit the resource - ' + this.props.resource.name}\n                    variant={ModalVariant.large}\n                    isOpen={this.state.isOpen}\n                    onClose={this.handleToggleDialog}\n                    actions={[\n                        <Button key=\"done\" variant=\"link\" id=\"done\" onClick={this.handleToggleDialog}>\n                            <Msg msgKey='done' />\n                        </Button>,\n                    ]}\n                >\n                    <Form isHorizontal>\n                        {this.props.permissions.map((p, row) => (\n                            <React.Fragment>\n                                <FormGroup\n                                    fieldId={`username-${row}`}\n                                    label={Msg.localize('User')}\n                                >\n                                    <TextInput id={`username-${row}`} type=\"text\" value={p.username} isDisabled />\n\n                                </FormGroup>\n                                <FormGroup\n                                    fieldId={`permissions-${row}`}\n                                    label={Msg.localize('permissions')}\n                                    isRequired\n                                >\n                                    <InputGroup>\n                                        <PermissionSelect\n                                            scopes={this.props.resource.scopes}\n                                            selected={(p.scopes as string[]).map(s => new Scope(s))}\n                                            direction={row === this.props.permissions.length - 1 ? \"up\" : \"down\"}\n                                            onSelect={selection => {\n                                                p.scopes = selection.map(s => s.name);\n                                                this.updateChanged(row);\n                                            }}\n                                        />\n                                        <Button\n                                            id={`save-${row}`}\n                                            isDisabled={!this.state.changed[row]}\n                                            onClick={() => this.savePermission(p)}\n                                        >\n                                            <OkIcon />\n                                        </Button>\n                                    </InputGroup>\n                                </FormGroup>\n                                <hr />\n                            </React.Fragment>\n                        ))}\n                    </Form>\n                </Modal>\n            </React.Fragment>\n        );\n    }\n}\n"],"mappings":"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"}